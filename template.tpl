___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Fullstory - Browser Tag",
  "categories": ["ANALYTICS", "CONVERSIONS", "DATA_WAREHOUSING", "HEAT_MAP", "SESSION_RECORDING"],
  "brand": {
    "id": "Fullstory",
    "displayName": "Fullstory",
    "thumbnail": "data:image/jpeg;base64,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/wCEo8P/APQc03/wLT/GvlWil7M0+uPsfVX/AAlHh/8A6Dmm/wDgWn+NH/CUeH/+g5pv/gWn+NfKtFHsw+uPsfVEnivw7GhZ9d00Af8AT0n+Nc3q/wAWvDOnKwtppb+YdEgQhc+7Ngflmvnuij2aJeLk9kdZ4r+IOseKiYJGFrYZ4tojw3+8f4v5e1cnRRV2sc0pOTuwqW2uZ7O5juLaV4Zo23JJG20qfY1FRTEnbVHrPhz4yzQRpb6/amYAY+024Ab/AIEvQ/UY+leg2HxA8K6ioMWtW0ZP8Nw3lEf99Yr5loqHBM6IYqcd9T6q/wCEo8P/APQc03/wLT/Gj/hKPD//AEHNN/8AAtP8a+VaKXszT64+x9Vf8JR4f/6Dmm/+Baf40f8ACUeH/wDoOab/AOBaf418q0UezD64+x9Vf8JR4f8A+g5pv/gWn+NB8UeH8f8AIc03/wAC0/xr5Voo9mH1x9iW6Ia7mIOQZGwR9aioorQ43qFFFFAgooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Z"
  },
  "description": "Automatically collect behavioral data into the Fullstory platform with the Fullstory Tag template.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "orgId",
    "displayName": "Org Id",
    "simpleValueType": true,
    "notSetText": "Org Id is required.",
    "help": "Your Org Id from Fullstory.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "[0-9A-Za-z._-]+"
        ]
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "debugMode",
    "checkboxText": "Debug mode",
    "simpleValueType": true,
    "help": "Enables Fullstory debug mode."
  },
  {
    "type": "CHECKBOX",
    "name": "runInIframe",
    "checkboxText": "Enable capture inside an iframe",
    "simpleValueType": true,
    "help": "Enables Fullstory inside an iframe."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const setInWindow = require('setInWindow');
const injectScript = require('injectScript');
// note: permission to log only during debug/preview
const log = require('logToConsole'); 

const debugMode = data.debugMode;
const runInIframe = data.runInIframe;
const orgId = data.orgId;

const host = 'fullstory.com';
const namespace = 'FS';
const script = 'edge.fullstory.com/s/' + debugMode ? 'fs-debug.js' : 'fs.js';


(function (){
  log('Recieved data:', data);

  if (!orgId) {
    return onFailure();
  }

  setInWindow('_fs_host', host);
  setInWindow('_fs_script', script);
  setInWindow('_fs_namespace', namespace);
  setInWindow('_fs_org', orgId);
  setInWindow('_fs_run_in_iframe', runInIframe);

  const url = "https://edge.fullstory.com/code/v2/snippet?type=raw";

  injectScript(url, onSuccess, onFailure);

  function onSuccess() {
    log('Successfully loaded the Fullstory Snippet.');
    data.gtmOnSuccess();
  }

  function onFailure() {
    log('Failed to load the Fullstory Snippet.');
    data.gtmOnFailure();
  }
}());


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://edge.fullstory.com/code/v2/snippet*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fs_host"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fs_script"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fs_run_in_iframe"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fs_org"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_fs_namespace"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: TestRuns
  code: |-
    mock('injectScript', function(url, onSuccess, onFailure) {
        onSuccess();
    });

    runCode();

    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 10/24/2024, 4:04:19 PM
